---
title: CAN Bus Interface Requirements
description: CAN protocol for real-time control and diagnostic trouble codes

requirements:
  
  - id: "CAN-001"
    title: "CAN 2.0B Protocol with 11-bit Identifiers"
    rationale: "CAN 2.0B is industry standard for real-time motor control"
    content:
      given: "CAN bus controller is initialized"
      when: "System boots and initializes CAN module"
      then: "CAN controller operates in CAN 2.0B mode with 11-bit (standard) message identifiers"
  - id: "CAN-002"
    title: "CAN Bus Bitrate 500 kbps"
    rationale: "500 kbps provides good range and sufficient bandwidth for real-time control"
    content:
      given: "CAN peripheral is being configured"
      when: "System sets CAN timing parameters"
      then: "CAN bitrate is set to 500 kilobits per second"
  - id: "CAN-003"
    title: "CAN Messages 8 Bytes Maximum"
    rationale: "Standard CAN frame payload, sufficient for all control messages"
    content:
      given: "CAN message is formatted"
      when: "System prepares message for transmission"
      then: "Message payload is maximum 8 bytes (0-8 bytes allowed)"
  
  - id: "CAN-010"
    title: "Motor Control Command Message"
    rationale: "Master controller needs reliable command transmission to motor controller"
    content:
      given: "Master system wants to control motor"
      when: "Motor control command is formatted into CAN frame"
      then: "Message contains: control byte, speed reference (RPM), current reference (A), mode, checksum"
  - id: "CAN-011"
    title: "Motor Status Message Transmission"
    rationale: "Master needs real-time feedback of motor state"
    content:
      given: "Motor control loop is running"
      when: "CAN message transmission interval (10 ms) elapses"
      then: "System transmits motor status including: state, speed, current, temperature, fault bits"
  - id: "CAN-012"
    title: "CAN Message Periodic Update 100 Hz"
    rationale: "Regular updates provide reliable communication link health check"
    content:
      given: "CAN bus is active"
      when: "10 milliseconds elapse"
      then: "Status messages are transmitted at 100 Hz (every 10 ms) consistently"
  
  - id: "CAN-020"
    title: "Diagnostic Trouble Code (DTC) Reporting"
    rationale: "DTC codes enable remote diagnostics and compliance with standards"
    content:
      given: "Motor controller detects a fault condition"
      when: "Fault is confirmed and logged"
      then: "System generates SAE J2012 format DTC code and transmits via CAN"
  - id: "CAN-021"
    title: "Immediate Fault Event Transmission"
    rationale: "Critical faults must be immediately communicated for safety"
    content:
      given: "Over-current or over-voltage fault is detected"
      when: "Hardware protection triggers"
      then: "System transmits fault message within 1 millisecond on CAN bus"
  - id: "CAN-022"
    title: "Over-Current Fault DTC P0A88"
    rationale: "Standard DTC enables system integration with OEM diagnostic tools"
    content:
      given: "Motor phase current exceeds safe limit"
      when: "Over-current fault is triggered"
      then: "System reports DTC code P0A88 (Motor Over-Current) via CAN"
  - id: "CAN-023"
    title: "Over-Voltage Fault DTC P0A8C"
    rationale: "Standard code for voltage faults in electric drive systems"
    content:
      given: "Supply voltage exceeds maximum rating"
      when: "Over-voltage protection activates"
      then: "System reports DTC code P0A8C (Motor Over-Voltage) via CAN"
  - id: "CAN-024"
    title: "Over-Temperature Fault DTC P0A80"
    rationale: "Standard DTC for inverter thermal protection"
    content:
      given: "Motor or inverter temperature exceeds limit"
      when: "Temperature sensor crosses threshold"
      then: "System reports DTC code P0A80 (Inverter Over-Temperature) via CAN"
  - id: "CAN-025"
    title: "Hall Sensor Fault DTC P0B00"
    rationale: "Standard code for sensor faults"
    content:
      given: "Hall sensor signal is lost or invalid"
      when: "Sensor validation fails"
      then: "System reports DTC code P0B00 (Hall Effect Sensor Fault) via CAN"
  
  - id: "CAN-030"
    title: "CAN Heartbeat Message"
    rationale: "Heartbeat enables detection of controller failure or communication loss"
    content:
      given: "System is operational"
      when: "1 second interval elapses"
      then: "System transmits heartbeat message at 1 Hz to confirm controller is alive"
  - id: "CAN-031"
    title: "Heartbeat Timeout Detection"
    rationale: "Loss of heartbeat indicates communication failure and triggers safe shutdown"
    content:
      given: "Heartbeat message reception is monitored"
      when: "2 seconds pass without receiving heartbeat"
      then: "System detects communication loss and transitions to safe state"
  - id: "CAN-032"
    title: "Bus-Off Error Detection"
    rationale: "CAN controller detects excessive bit errors and reports condition"
    content:
      given: "CAN bus has electrical fault or severe noise"
      when: "CAN controller error count exceeds threshold"
      then: "System enters bus-off state, logs error, and reports DTC"
  
  - id: "CAN-040"
    title: "CRC-8 Checksum on All Messages"
    rationale: "Checksum provides error detection for message corruption"
    content:
      given: "CAN message is being formatted"
      when: "Message content is finalized"
      then: "CRC-8 checksum is calculated and included as last byte"
  - id: "CAN-041"
    title: "Big-Endian Byte Order for Multi-Byte Values"
    rationale: "Network byte order (big-endian) is standard for CAN in automotive/industrial"
    content:
      given: "Multi-byte parameter is being encoded into CAN frame"
      when: "16-bit or 32-bit value is placed in message"
      then: "Value is encoded in big-endian byte order (MSB first)"
